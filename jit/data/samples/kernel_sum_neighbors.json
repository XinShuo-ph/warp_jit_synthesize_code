{
  "python_source": "@wp.kernel\ndef kernel_sum_neighbors(input: wp.array(dtype=float), output: wp.array(dtype=float), width: int):\n    tid = wp.tid()\n    total = float(0.0)\n    for i in range(-1, 2):\n        idx = tid + i\n        if idx >= 0 and idx < width:\n            total = total + input[idx]\n    output[tid] = total\n",
  "cpp_forward": "void kernel_sum_neighbors_a8ab82d4_cpu_kernel_forward(\n    wp::launch_bounds_t dim,\n    size_t task_index,\n    wp_args_kernel_sum_neighbors_a8ab82d4 *_wp_args)\n{\n    //---------\n    // argument vars\n    wp::array_t<wp::float32> var_input = _wp_args->input;\n    wp::array_t<wp::float32> var_output = _wp_args->output;\n    wp::int32 var_width = _wp_args->width;\n    //---------\n    // primal vars\n    wp::int32 var_0;\n    const wp::float32 var_1 = 0.0;\n    wp::float32 var_2;\n    const wp::int32 var_3 = -1;\n    wp::int32 var_4;\n    const wp::int32 var_5 = 0;\n    bool var_6;\n    bool var_7;\n    bool var_8;\n    wp::float32* var_9;\n    wp::float32 var_10;\n    wp::float32 var_11;\n    wp::float32 var_12;\n    const wp::int32 var_13 = 0;\n    wp::int32 var_14;\n    const wp::int32 var_15 = 0;\n    bool var_16;\n    bool var_17;\n    bool var_18;\n    wp::float32* var_19;\n    wp::float32 var_20;\n    wp::float32 var_21;\n    wp::float32 var_22;\n    const wp::int32 var_23 = 1;\n    wp::int32 var_24;\n    const wp::int32 var_25 = 0;\n    bool var_26;\n    bool var_27;\n    bool var_28;\n    wp::float32* var_29;\n    wp::float32 var_30;\n    wp::float32 var_31;\n    wp::float32 var_32;\n    //---------\n    // forward\n    // def kernel_sum_neighbors(input: wp.array(dtype=float), output: wp.array(dtype=float), width: int):       <L 39>\n    // tid = wp.tid()                                                                         <L 40>\n    var_0 = builtin_tid1d();\n    // total = float(0.0)                                                                     <L 41>\n    var_2 = wp::float(var_1);\n    // for i in range(-1, 2):                                                                 <L 42>\n    // idx = tid + i                                                                          <L 43>\n    var_4 = wp::add(var_0, var_3);\n    // if idx >= 0 and idx < width:                                                           <L 44>\n    var_6 = (var_4 >= var_5);\n    var_7 = (var_4 < var_width);\n    var_8 = var_6 && var_7;\n    if (var_8) {\n        // total = total + input[idx]                                                         <L 45>\n        var_9 = wp::address(var_input, var_4);\n        var_11 = wp::load(var_9);\n        var_10 = wp::add(var_2, var_11);\n    }\n    var_12 = wp::where(var_8, var_10, var_2);\n    // idx = tid + i                                                                          <L 43>\n    var_14 = wp::add(var_0, var_13);\n    // if idx >= 0 and idx < width:                                                           <L 44>\n    var_16 = (var_14 >= var_15);\n    var_17 = (var_14 < var_width);\n    var_18 = var_16 && var_17;\n    if (var_18) {\n        // total = total + input[idx]                                                         <L 45>\n        var_19 = wp::address(var_input, var_14);\n        var_21 = wp::load(var_19);\n        var_20 = wp::add(var_12, var_21);\n    }\n    var_22 = wp::where(var_18, var_20, var_12);\n    // idx = tid + i                                                                          <L 43>\n    var_24 = wp::add(var_0, var_23);\n    // if idx >= 0 and idx < width:                                                           <L 44>\n    var_26 = (var_24 >= var_25);\n    var_27 = (var_24 < var_width);\n    var_28 = var_26 && var_27;\n    if (var_28) {\n        // total = total + input[idx]                                                         <L 45>\n        var_29 = wp::address(var_input, var_24);\n        var_31 = wp::load(var_29);\n        var_30 = wp::add(var_22, var_31);\n    }\n    var_32 = wp::where(var_28, var_30, var_22);\n    // output[tid] = total                                                                    <L 46>\n    wp::array_store(var_output, var_0, var_32);\n}",
  "cpp_backward": "void kernel_sum_neighbors_a8ab82d4_cpu_kernel_backward(\n    wp::launch_bounds_t dim,\n    size_t task_index,\n    wp_args_kernel_sum_neighbors_a8ab82d4 *_wp_args,\n    wp_args_kernel_sum_neighbors_a8ab82d4 *_wp_adj_args)\n{\n    //---------\n    // argument vars\n    wp::array_t<wp::float32> var_input = _wp_args->input;\n    wp::array_t<wp::float32> var_output = _wp_args->output;\n    wp::int32 var_width = _wp_args->width;\n    wp::array_t<wp::float32> adj_input = _wp_adj_args->input;\n    wp::array_t<wp::float32> adj_output = _wp_adj_args->output;\n    wp::int32 adj_width = _wp_adj_args->width;\n    //---------\n    // primal vars\n    wp::int32 var_0;\n    const wp::float32 var_1 = 0.0;\n    wp::float32 var_2;\n    const wp::int32 var_3 = -1;\n    wp::int32 var_4;\n    const wp::int32 var_5 = 0;\n    bool var_6;\n    bool var_7;\n    bool var_8;\n    wp::float32* var_9;\n    wp::float32 var_10;\n    wp::float32 var_11;\n    wp::float32 var_12;\n    const wp::int32 var_13 = 0;\n    wp::int32 var_14;\n    const wp::int32 var_15 = 0;\n    bool var_16;\n    bool var_17;\n    bool var_18;\n    wp::float32* var_19;\n    wp::float32 var_20;\n    wp::float32 var_21;\n    wp::float32 var_22;\n    const wp::int32 var_23 = 1;\n    wp::int32 var_24;\n    const wp::int32 var_25 = 0;\n    bool var_26;\n    bool var_27;\n    bool var_28;\n    wp::float32* var_29;\n    wp::float32 var_30;\n    wp::float32 var_31;\n    wp::float32 var_32;\n    //---------\n    // dual vars\n    wp::int32 adj_0 = {};\n    wp::float32 adj_1 = {};\n    wp::float32 adj_2 = {};\n    wp::int32 adj_3 = {};\n    wp::int32 adj_4 = {};\n    wp::int32 adj_5 = {};\n    bool adj_6 = {};\n    bool adj_7 = {};\n    bool adj_8 = {};\n    wp::float32 adj_9 = {};\n    wp::float32 adj_10 = {};\n    wp::float32 adj_11 = {};\n    wp::float32 adj_12 = {};\n    wp::int32 adj_13 = {};\n    wp::int32 adj_14 = {};\n    wp::int32 adj_15 = {};\n    bool adj_16 = {};\n    bool adj_17 = {};\n    bool adj_18 = {};\n    wp::float32 adj_19 = {};\n    wp::float32 adj_20 = {};\n    wp::float32 adj_21 = {};\n    wp::float32 adj_22 = {};\n    wp::int32 adj_23 = {};\n    wp::int32 adj_24 = {};\n    wp::int32 adj_25 = {};\n    bool adj_26 = {};\n    bool adj_27 = {};\n    bool adj_28 = {};\n    wp::float32 adj_29 = {};\n    wp::float32 adj_30 = {};\n    wp::float32 adj_31 = {};\n    wp::float32 adj_32 = {};\n    //---------\n    // forward\n    // def kernel_sum_neighbors(input: wp.array(dtype=float), output: wp.array(dtype=float), width: int):       <L 39>\n    // tid = wp.tid()                                                                         <L 40>\n    var_0 = builtin_tid1d();\n    // total = float(0.0)                                                                     <L 41>\n    var_2 = wp::float(var_1);\n    // for i in range(-1, 2):                                                                 <L 42>\n    // idx = tid + i                                                                          <L 43>\n    var_4 = wp::add(var_0, var_3);\n    // if idx >= 0 and idx < width:                                                           <L 44>\n    var_6 = (var_4 >= var_5);\n    var_7 = (var_4 < var_width);\n    var_8 = var_6 && var_7;\n    if (var_8) {\n        // total = total + input[idx]                                                         <L 45>\n        var_9 = wp::address(var_input, var_4);\n        var_11 = wp::load(var_9);\n        var_10 = wp::add(var_2, var_11);\n    }\n    var_12 = wp::where(var_8, var_10, var_2);\n    // idx = tid + i                                                                          <L 43>\n    var_14 = wp::add(var_0, var_13);\n    // if idx >= 0 and idx < width:                                                           <L 44>\n    var_16 = (var_14 >= var_15);\n    var_17 = (var_14 < var_width);\n    var_18 = var_16 && var_17;\n    if (var_18) {\n        // total = total + input[idx]                                                         <L 45>\n        var_19 = wp::address(var_input, var_14);\n        var_21 = wp::load(var_19);\n        var_20 = wp::add(var_12, var_21);\n    }\n    var_22 = wp::where(var_18, var_20, var_12);\n    // idx = tid + i                                                                          <L 43>\n    var_24 = wp::add(var_0, var_23);\n    // if idx >= 0 and idx < width:                                                           <L 44>\n    var_26 = (var_24 >= var_25);\n    var_27 = (var_24 < var_width);\n    var_28 = var_26 && var_27;\n    if (var_28) {\n        // total = total + input[idx]                                                         <L 45>\n        var_29 = wp::address(var_input, var_24);\n        var_31 = wp::load(var_29);\n        var_30 = wp::add(var_22, var_31);\n    }\n    var_32 = wp::where(var_28, var_30, var_22);\n    // output[tid] = total                                                                    <L 46>\n    // wp::array_store(var_output, var_0, var_32);\n    //---------\n    // reverse\n    wp::adj_array_store(var_output, var_0, var_32, adj_output, adj_0, adj_32);\n    // adj: output[tid] = total                                                               <L 46>\n    wp::adj_where(var_28, var_30, var_22, adj_28, adj_30, adj_22, adj_32);\n    if (var_28) {\n        wp::adj_add(var_22, var_31, adj_22, adj_29, adj_30);\n        wp::adj_address(var_input, var_24, adj_input, adj_24, adj_29);\n        // adj: total = total + input[idx]                                                    <L 45>\n    }\n    // adj: if idx >= 0 and idx < width:                                                      <L 44>\n    wp::adj_add(var_0, var_23, adj_0, adj_23, adj_24);\n    // adj: idx = tid + i                                                                     <L 43>\n    wp::adj_where(var_18, var_20, var_12, adj_18, adj_20, adj_12, adj_22);\n    if (var_18) {\n        wp::adj_add(var_12, var_21, adj_12, adj_19, adj_20);\n        wp::adj_address(var_input, var_14, adj_input, adj_14, adj_19);\n        // adj: total = total + input[idx]                                                    <L 45>\n    }\n    // adj: if idx >= 0 and idx < width:                                                      <L 44>\n    wp::adj_add(var_0, var_13, adj_0, adj_13, adj_14);\n    // adj: idx = tid + i                                                                     <L 43>\n    wp::adj_where(var_8, var_10, var_2, adj_8, adj_10, adj_2, adj_12);\n    if (var_8) {\n        wp::adj_add(var_2, var_11, adj_2, adj_9, adj_10);\n        wp::adj_address(var_input, var_4, adj_input, adj_4, adj_9);\n        // adj: total = total + input[idx]                                                    <L 45>\n    }\n    // adj: if idx >= 0 and idx < width:                                                      <L 44>\n    wp::adj_add(var_0, var_3, adj_0, adj_3, adj_4);\n    // adj: idx = tid + i                                                                     <L 43>\n    // adj: for i in range(-1, 2):                                                            <L 42>\n    wp::adj_float(var_1, adj_1, adj_2);\n    // adj: total = float(0.0)                                                                <L 41>\n    // adj: tid = wp.tid()                                                                    <L 40>\n    // adj: def kernel_sum_neighbors(input: wp.array(dtype=float), output: wp.array(dtype=float), width: int):  <L 39>\n    return;\n}",
  "metadata": {
    "kernel_name": "kernel_sum_neighbors",
    "mangled_name": "kernel_sum_neighbors_a8ab82d4",
    "device": "cpu",
    "arg_names": [
      "input",
      "output",
      "width"
    ],
    "arg_types": {
      "input": "array<class 'warp._src.types.float32'>",
      "output": "array<class 'warp._src.types.float32'>",
      "width": "<class 'int'>"
    },
    "has_backward": true
  }
}