# Objective
Adapt the current production code to use **JAX + CUDA** backend.
Currently no GPU device is available for agent to use. Provide concise code and command for me to test on GPU device by myself.

# Milestones

1. Reproduce the current production code using **CPU backend**. If there are multiple candidate branches (e.g. `cursor/agent-work-merge-process-....`), pick the best base branch and stick to it.

2. Adapt the code to use **CUDA backend**. Do this iteratively, iterate over:
- All function/kernel pattern types generated by the synthesis pipeline
- Both forward and backward pass (e.g. `jax.grad`, `jax.vjp`, `jax.jvp`)
- Batch generation pipeline
- Validation tools
- Test suite for me to run later on an actual GPU device

Since there are often ~10+ pattern types in a realistic generator, expect ~20 iterations total. Focus on one iteration / one pattern at a time.

## GPU Test Commands (for you to run on a CUDA machine)

### Install (pick one)
CUDA 12 (recommended if your system matches):
```bash
python -m pip install -U "jax[cuda12]"
```

CPU-only (sanity):
```bash
python -m pip install -U "jax"
```

### Verify device selection
```bash
python - <<'PY'
import jax
print("jax version:", jax.__version__)
print("devices:", jax.devices())
print("default backend:", jax.default_backend())
PY
```

### Force a quick compile on GPU (simple smoke test)
```bash
python - <<'PY'
import jax, jax.numpy as jnp

@jax.jit
def f(x):
    return jnp.sin(x) * 2.0 + x @ x.T

x = jnp.ones((256, 256), dtype=jnp.float32)
y = f(x).block_until_ready()
print("ok, shape:", y.shape, "device:", y.device)
PY
```


